const mark_argamoza =
"<h2>Le Mans - Sucursal Argamoza</h2>" +
"<p> Av. Argomosa #36</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105014&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 014</a></p>" +
"<p><a target='_blank' href='https://www.google.com/maps/place/Le+Mans+Argamoza/@-17.7787988,-63.1735769,18.5z/data=!4m5!3m4!1s0x93f1e9fd69831d8f:0x1d464bcc347e44b2!8m2!3d-17.7787503!4d-63.1731049'>Ver en Google Maps</a></p>"
;

const mark_melchor =
"<h2>Le Mans - Sucursal Melchor Pinto</h2>" +
"<p> Av. Melchor Pinto</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105014&text&type=phone_number&app_absent=0'><p><img src='/assets/svg/whatsapp.svg'> 721 05 014</p></a></p>" +
"<p><a target='_blank' href='https://www.google.es/maps/place/Le+Mans+Melchor+Pinto/@-17.7820127,-63.1742352,16z/data=!4m9!1m2!2m1!1sle+mans!3m5!1s0x93f1e9cffcfbcab3:0xfbf047a683138f9a!8m2!3d-17.7826247!4d-63.1678613!15sCgdsZSBtYW5zkgEIdG9vbHJvb23gAQA?hl=es'>Ver en Google Maps</a></p>"
;

const mark_virgen4to =
"<h2>Le Mans - Sucursal Virgen de Cotoca</h2>" +
"<p> Av. Virgen de Cotoca 4to anillo</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105023&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 023</a></p>" +
'<p><a target="_blank" href="https://www.google.es/maps/place/Le+Mans/@-17.7796016,-63.1475531,17.08z/data=!4m5!3m4!1s0x93f1e885798c2e2f:0x8e0dce2907c1c381!8m2!3d-17.7800237!4d-63.146914?hl=es">Ver en Google Maps</a></p>'
;
const mark_virgen5to =
"<h2>Le Mans - Sucursal Virgen de Cotoca</h2>" +
"<p> Av. Virgen de Cotoca 5to anillo</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59168920902&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 689 20 902</a></p>" +
'<p><a target="_blank" href="https://www.google.ru/maps/place/HomeCenter+LE+MANS/@-17.7777157,-63.142622,369m/data=!3m1!1e3!4m5!3m4!1s0x93f1e9e4472dab81:0x60d5752f25e64b8e!8m2!3d-17.7773073!4d-63.1425245">Ver en Google Maps</a></p>'
;
const mark_bayon =
"<h2>Le Mans - Sucursal Bayon</h2>" +
"<p> Entre 2do y 3er anillo</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105026&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 026</a></p>" +
'<p><a target="_blank" href="https://goo.gl/maps/oUCJvDqJtpGEn1B69">Ver en Google Maps</a></p>'
;
const mark_trompillo =
"<h2>Le Mans - Sucursal El Trompillo</h2>" +
"<p> Av. El trompillo 719 entre Av. Santos Dumont, Av Escuadron Velasco</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105011&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 011</a></p>" +
'<p><a target="_blank" href="https://www.google.com/maps/place/Le+Mans+El+Trompillo/@-17.7996861,-63.1821598,18z/data=!4m6!3m5!1s0x93f1e83f754c8203:0xcb1e01d1e9a510da!8m2!3d-17.7995028!4d-63.1811772!16s%2Fg%2F11f16w01l8?hl=es">Ver en Google Maps</a></p>'
;
const mark_grigota =
"<h2>Le Mans - Sucursal Grigota</h2>" +
"<p> Av. Grigota entre 2do y 3er anillo</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105014&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 014</a></p>" +
'<p><a target="_blank" href="https://www.google.com/maps/place/MegaLemans/@-17.801871,-63.1960688,19z/data=!4m6!3m5!1s0x93f1e82234e1ea41:0x8fc807c9a89b0a8b!8m2!3d-17.8015798!4d-63.1962245!16s%2Fg%2F11dymv1w9r">Ver en Google Maps</a></p>'
;
const mark_banzer =
"<h2>Le Mans - Sucursal Banzer</h2>" +
"<p> Av. Banzer 4to anillo</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105028&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 028</a></p>" +
'<p><a arget="_blank" href="https://www.google.com/maps/place/LeMans,+Santa+Cruz+de+la+Sierra/data=!4m2!3m1!1s0x93f1e7bf0d91e71b:0x864b285fdf0a435d?utm_source=mstt_1&entry=gps&lucs=swa">Ver en Google Maps</a></p>'
;
const mark_cristo =
"<h2>Le Mans - Sucursal El Cristo</h2>" +
"<p> Entre 2do y 3er anillo</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105021&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 021</a></p>" +
'<p><a target="_blank" href="https://www.google.com/maps/place/LE+MANS/@-17.7653678,-63.1811231,19.5z/data=!4m5!3m4!1s0x93f1e765054956a1:0xe422420a48899dd7!8m2!3d-17.7649634!4d-63.180865?hl=es&shorturl=1">Ver en Google Maps</a></p>'
;
const mark_montero =
"<h2>Le Mans - Sucursal Montero</h2>" +
"<p> Av. Montero</p>" +
"<a target='_blank' href='https://api.whatsapp.com/send/?phone=59167898159&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 678 98 159</a></p>" +
'<p><a target="_blank" href="https://www.google.com/maps/place/Le+Mans+Montero/@-17.3393516,-63.2585559,20z/data=!4m6!3m5!1s0x93ee3f69d7eb5f4d:0xd479a06b4917fb7f!8m2!3d-17.3390453!4d-63.2577834!16s%2Fg%2F11j7kpjmfq?hl=es">Ver en Google Maps</a></p>'
;
const mark_heroinas =
"<h2>Le Mans - Sucursal Heroínas</h2>" +
"<p> Av. Heroínas</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105029&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 05 029</a></p>" +
'<p><a target="_blank" href="https://www.google.com/maps/place/Le+ManS/@-17.3933108,-66.1625681,20.5z/data=!4m5!3m4!1s0x93e37301037820b1:0x86b771cd0cf36426!8m2!3d-17.3933621!4d-66.1625813?hl=es&shorturl=1">Ver en Google Maps</a></p>'
;
const mark_viacha =
"<h2>Le Mans - Sucursal Viacha</h2>" +
"<p> Viacha</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172105014&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> Null</a></p>" +
'<p><a target="_blank" href="https://goo.gl/maps/1AFQxuePTLzdNP4G8">Ver en Google Maps</a></p>'
;
const mark_sanpedro =
"<h2>Le Mans - Sucursal San Pedro</h2>" +
"<p> San Pedro</p>" +
"<p><a target='_blank' href='https://api.whatsapp.com/send/?phone=59172107107&text&type=phone_number&app_absent=0'><img src='/assets/svg/whatsapp.svg'> 721 07 107</a></p>" +
'<p><a target="_blank" href="https://www.google.com/maps/place/Toscana+Pizzas+y+Pastas/@-16.5035558,-68.1374366,19z/data=!4m5!3m4!1s0x915f207a1cd874dd:0x336455e70553f535!8m2!3d-16.5034999!4d-68.1369922">Ver en Google Maps</a></p>'
;
var routes = document.getElementById("route-btn");
var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> | &copy; <a style="color:#CE111B ;" href="https://www.github.com/nelsonrs" title="Code by NRS">NRS</a> contributors'
    ,detectRetina: true
  });
osmhumanitarian = L.tileLayer('http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
  attribution: 'Datos \u00a9 <a href="http://www.openstreetmap.org">'+'Colaboradores de OpenStreetMap</a> | Teselas \u00a9 <a href="https://github.com/hotosm/HDM-CartoCSS">Humanitarian HDM</a> | &copy; <a style="color:#CE111B ;" href="https://www.github.com/nelsonrs" title="Code by NRS">NRS</a>'
  ,detectRetina: true
});
var baseLayers = {
  "Callejero (OSM)": osm,
  "Humanitario (OSM)": osmhumanitarian,
  };
var map = L.map('map', {
  gestureHandling: true,
  center: [-17.288,-65.465],
  zoom: 8,
  layers: [osmhumanitarian],
});
L.control.layers(baseLayers).addTo(map);
        
var LeafIcon = L.Icon.extend({
  options: {
      iconSize:     [38, 95],
      shadowSize:   [50, 64],
      iconAnchor:   [22, 94],
      shadowAnchor: [4, 62],
      popupAnchor:  [-3, -76]
  }
});
var icon = new LeafIcon({iconUrl: '/assets/svg/marker.svg'});

var sucArgamoza = L.marker([-17.778587, -63.1732285], {icon: icon,title: 'Le Mans - Sucursal Argamoza',riseOnHover:true,riseOffset:250}).bindPopup(mark_argamoza).addTo(map);
var sucMelchor = L.marker([-17.7826247, -63.1678613], {icon: icon,title: 'Le Mans - Sucursal Melchor Pinto',riseOnHover:true,riseOffset:250}).bindPopup(mark_melchor).addTo(map);
var sucVirgenCotoca4 = L.marker([-17.7800237, -63.146914], {icon: icon,title: 'Le Mans - Sucursal Virgen de Cotoca 4to Anillo',riseOnHover:true,riseOffset:250}).bindPopup(mark_virgen4to).addTo(map);
var sucVirgenCotoca5 = L.marker([-17.7773073, -63.1425245], {icon: icon,title: 'Le Mans - Sucursal Virgen de Cotoca 5to Anillo',riseOnHover:true,riseOffset:250}).bindPopup(mark_virgen5to).addTo(map);
var sucTrompillo = L.marker([-17.7995028, -63.1811772], {icon: icon,title: 'Le Mans - Sucursal El Trompillo',riseOnHover:true,riseOffset:250}).bindPopup(mark_trompillo).addTo(map);
var sucGrigota = L.marker([-17.8015839, -63.1962206], {icon: icon,title: 'Le Mans - Sucursal Grigotá',riseOnHover:true,riseOffset:250}).bindPopup(mark_grigota).addTo(map);
var sucElCristo = L.marker([-17.7649668, -63.1808651], {icon: icon,title: 'Le Mans - Sucursal El Cristo',riseOnHover:true,riseOffset:250}).bindPopup(mark_cristo).addTo(map);
var sucBanzer = L.marker([-17.7506613, -63.1760149], {icon: icon,title: 'Le Mans - Sucursal Banzer',riseOnHover:true,riseOffset:250}).bindPopup(mark_banzer).addTo(map);
var sucSanPedro = L.marker([-16.5034999, -68.1369922], {icon: icon,title: 'Le Mans - Sucursal San Pedro',riseOnHover:true,riseOffset:250}).bindPopup(mark_sanpedro).addTo(map);
var sucViacha = L.marker([-16.5237602, -68.1809646], {icon: icon,title: 'Le Mans - Sucursal Viacha',riseOnHover:true,riseOffset:250}).bindPopup(mark_viacha).addTo(map);
var sucHeroinas = L.marker([-17.3933621, -66.1625813], {icon: icon,title: 'Le Mans - Sucursal Heroínas',riseOnHover:true,riseOffset:250}).bindPopup(mark_heroinas).addTo(map);
var sucMontero = L.marker([-17.3390453, -63.2577834], {icon: icon,title: 'Le Mans - Sucursal Montero',riseOnHover:true,riseOffset:250}).bindPopup(mark_montero).addTo(map);
var sucBayon = L.marker([-17.779778, -63.164222], {icon: icon,title: 'Le Mans - Sucursal Bayon',riseOnHover:true,riseOffset:250}).bindPopup(mark_bayon).addTo(map);
        
var locateMe = L.control.locate({
  followCompassStyle:{
      color: '#CE111B',
      fillColor: '#CE111B'
  }
  ,followCircleStyle:{
      color: '#CE111B',
      fillColor: '#CE111B'
  }
  ,circleStyle:{
      color: '#CE111B',
      fillColor: '#CE111B'
  }
  ,followMarkerStyle:{
      color: '#fff',
      fillColor: '#CE111B'
  }
  ,locateOptions:{
      maxZoom: 15,
      enableHighAccuracy: true
  }
  ,strings:{
      title: "Activar mi Ubicación",
      popup: "Estas cerca de {distance} metros desde aquí",
  },
}).addTo(map);       

routes.addEventListener("click", function () {
  function recursivo() {
    function locateTouch(me, to) {
      var distance = map.distance(me,to);
      return distance;
    };
    var d1 = locateTouch((locateMe._marker._latlng),(sucArgamoza._latlng))
    var d2 = locateTouch((locateMe._marker._latlng),(sucMelchor._latlng))
    var d3 = locateTouch((locateMe._marker._latlng),(sucVirgenCotoca4._latlng))
    var d4 = locateTouch((locateMe._marker._latlng),(sucVirgenCotoca5._latlng))
    var d5 = locateTouch((locateMe._marker._latlng),(sucTrompillo._latlng))
    var d6 = locateTouch((locateMe._marker._latlng),(sucGrigota._latlng))
    var d7 = locateTouch((locateMe._marker._latlng),(sucElCristo._latlng))
    var d8 = locateTouch((locateMe._marker._latlng),(sucBanzer._latlng))
    var d9 = locateTouch((locateMe._marker._latlng),(sucSanPedro._latlng))
    var d10 = locateTouch((locateMe._marker._latlng),(sucViacha._latlng))
    var d11 = locateTouch((locateMe._marker._latlng),(sucHeroinas._latlng))
    var d12 = locateTouch((locateMe._marker._latlng),(sucMontero._latlng))
    var d13 = locateTouch((locateMe._marker._latlng),(sucBayon._latlng))
    var r = Math.min(...[d1,d2,d3,d4,d5,d6,d7,d8,d9,d10,d11,d12,d13])
    if (r==d1) {r = sucArgamoza._latlng} else if(r==d2){ r = sucMelchor._latlng} else if(r==d3){ r = sucVirgenCotoca4._latlng} else if(r==d4){ r = sucVirgenCotoca5._latlng} else if(r==d5){ r = sucTrompillo._latlng} else if(r==d6){ r = sucGrigota._latlng} else if(r==d7){ r = sucElCristo._latlng}else if(r==d8){ r = sucBanzer._latlng}else if(r==d9){ r = sucSanPedro._latlng}else if(r==d10){ r = sucViacha._latlng}else if(r==d11){ r = sucHeroinas._latlng}else if(r==d12){ r = sucMontero._latlng}else if(r==d13){ r = sucBayon._latlng}
    return r;
  }
  var routing = new L.Routing.control({
    addWaypoints:false,
    draggableWaypoints:false,
    routeWhileDragging:[true],
    language: 'es', 
    waypoints: [
      L.latLng(locateMe._marker._latlng),
      L.latLng(recursivo())
    ],
  })
    map.addControl(routing);
    if (locateMe._active===true) {
      routes.classList.add("active");
    }
    console.log(locateMe)
});


var popup = L.popup()
.setLatLng([-17.288,-65.465])
.setContent("Activa tu GPS y presiona el icono <img title='GPS' src='/assets/svg/gps.svg'/> \n y luego <img title='Rutas' src='/assets/svg/route.svg'/> para ver la sucursal mas cercana")
.openOn(map);